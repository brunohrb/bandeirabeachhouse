function abrirDespesasDetalhe(unidade, ano, mes) {

    const despesas = getDb(DB_DESPESAS).filter(d =>
        d.unidade === unidade &&
        d.data.startsWith(`${ano}-${mes}`)
    );

    let html = `
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
    `;

    if (despesas.length === 0) {
        html += `
            <tr>
                <td colspan="4" style="text-align:center;padding:20px;">
                    Nenhuma despesa encontrada.
                </td>
            </tr>
        `;
    } else {
        despesas.forEach(d => {
            html += `
                <tr>
                    <td>${new Date(d.data).toLocaleDateString("pt-BR")}</td>
                    <td>${d.descricao}</td>
                    <td>${d.categoria}</td>
                    <td>${formatCurrency(d.valor)}</td>
                </tr>
            `;
        });
    }

    html += "</tbody>";

    // reutiliza a tabela de despesas (sem criar modal novo ainda)
    showPage("despesas", document.querySelector('.menu-item[onclick*="despesas"]'));
    document.getElementById("tabela-despesas-detalhada").innerHTML = html;
}
